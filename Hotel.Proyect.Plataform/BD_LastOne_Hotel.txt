
USE MASTER
GO

IF DB_ID ('Hotel_BD') IS NOT NULL
BEGIN
	DROP DATABASE Hotel_BD
END
GO

CREATE DATABASE Hotel_BD
GO
 
USE Hotel_BD
GO

--ESTADO DE HABITACION
CREATE TABLE EstadoHabitacion
(
	idEstado INT NOT NULL IDENTITY(1,1) PRIMARY KEY,
	nombre VARCHAR(20) NOT NULL
)
GO

--habitacion
INSERT INTO EstadoHabitacion (nombre) VALUES('Ocupado')
INSERT INTO EstadoHabitacion (nombre) VALUES('Libre')
INSERT INTO EstadoHabitacion (nombre) VALUES('Reservada')
INSERT INTO EstadoHabitacion (nombre) VALUES('Historica')

SELECT * FROM EstadoHabitacion
GO


--TIPO HABITACION
CREATE TABLE TipoHabitacion
(
	idTipo INT NOT NULL IDENTITY(1,1) PRIMARY KEY,
	nombre VARCHAR(30) NOT NULL
)
GO

--TipoHabitacion
INSERT INTO TipoHabitacion(nombre) VALUES('Sencillas') --posee una cama simple o individual--precio 80.00
INSERT INTO TipoHabitacion(nombre) VALUES('Dobles')		--posee dos camas individuales --precio 150.00
INSERT INTO TipoHabitacion(nombre) VALUES('Triple')		--precio 200.00
INSERT INTO TipoHabitacion(nombre) VALUES('Matrimonial')	--precio 180.00
INSERT INTO TipoHabitacion(nombre) VALUES('Familiares')		--precio 300.00
INSERT INTO TipoHabitacion(nombre) VALUES('Tipo Estudio')	--precio 120.00
INSERT INTO TipoHabitacion(nombre) VALUES('Tipo Suite') --aqui lo podemos dividir por junior,doble,presidencial precio 800.00

--respecto al suite junior puede poseer un dormitorio con baño y salon de estar o recibo
--el suite presidencial puede poseer varios dormitorios con sus baños, salon recibo en algunos comedor o cocina, es un mobiliario lujoso
--la de estudio puede poseer las mismas que la de sencillas
SELECT * FROM TipoHabitacion
GO


--TIPO PAGO
CREATE TABLE TipoPago
(
	idPago INT NOT NULL IDENTITY(1,1) PRIMARY KEY,
	tarjeta VARCHAR(30) NOT NULL
)
GO

--TipoPago
INSERT INTO TipoPago(tarjeta) VALUES('Master Card')
INSERT INTO TipoPago(tarjeta) VALUES('BCP')
INSERT INTO TipoPago(tarjeta) VALUES('BBVA')
INSERT INTO TipoPago(tarjeta) VALUES('Visa')
INSERT INTO TipoPago(tarjeta) VALUES('Scotiabank')

SELECT * FROM TipoPago
GO


--PAGO
CREATE TABLE Pago
(
	id INT NOT NULL IDENTITY(1,1) PRIMARY KEY,
	importe MONEY NOT NULL,
	idPago INT REFERENCES TipoPago
)
GO

--Pago
INSERT INTO Pago(importe,idPago) VALUES ('130.00',1)
INSERT INTO Pago(importe,idPago) VALUES ('140.00',2)
INSERT INTO Pago(importe,idPago) VALUES ('250.00',3)
INSERT INTO Pago(importe,idPago) VALUES ('60.00',4)
INSERT INTO Pago(importe,idPago) VALUES ('50.00',5)

SELECT * FROM Pago
GO

--HABITACION
CREATE TABLE Habitacion 
(
	idHabitacion INT NOT NULL IDENTITY(1,1) PRIMARY KEY,
	nombre CHAR(3) NOT NULL,
	descripcion VARCHAR(500) NOT NULL,
	idEstado INT REFERENCES TipoHabitacion,
	idTipo INT  REFERENCES EstadoHabitacion,
	cantidad INT NOT NULL,
	precio MONEY NOT NULL
)
GO

--Habitacion
--TipoHabitacion
-->Sencillas -->precio 80.00  -->Dobles -->precio 150.00 -->Triple -->200.00 -->Matrimonial -->precio 180.00 
-->Familiares -->precio 300.00 -->Tipo Estudio -->precio 120.00 -->Tipo Suite -->precio 800.00

--EstadoHabitacion -->Ocupado, Libre, Reservada, Historica

INSERT INTO Habitacion (nombre,descripcion,idEstado,idTipo,cantidad,precio) VALUES ('401','Estas elegantes habitaciones ase encuentran en planta superior del edificio, podran disfrutar de la vista panoramica del mar Limeño.',1,1,2,'160.00')
INSERT INTO Habitacion (nombre,descripcion,idEstado,idTipo,cantidad,precio) VALUES ('402','Estas elegantes habitaciones ase encuentran en planta superior del edificio, podran disfrutar de la vista panoramica del mar Limeño.',2,2,1,'150.00')
INSERT INTO Habitacion (nombre,descripcion,idEstado,idTipo,cantidad,precio) VALUES ('403','Estas elegantes habitaciones ase encuentran en planta superior del edificio, podran disfrutar de la vista panoramica del mar Limeño.',3,3,3,'600.00')
INSERT INTO Habitacion (nombre,descripcion,idEstado,idTipo,cantidad,precio) VALUES ('404','Estas elegantes habitaciones ase encuentran en planta superior del edificio, podran disfrutar de la vista panoramica del mar Limeño.',4,4,2,'360.00')
INSERT INTO Habitacion (nombre,descripcion,idEstado,idTipo,cantidad,precio) VALUES ('405','Estas elegantes habitaciones ase encuentran en planta superior del edificio, podran disfrutar de la vista panoramica del mar Limeño.',5,1,3,'900.00')
INSERT INTO Habitacion (nombre,descripcion,idEstado,idTipo,cantidad,precio) VALUES ('405','Estas elegantes habitaciones ase encuentran en planta superior del edificio, podran disfrutar de la vista panoramica del mar Limeño.',6,2,2,'240.00')
INSERT INTO Habitacion (nombre,descripcion,idEstado,idTipo,cantidad,precio) VALUES ('405','Estas elegantes habitaciones ase encuentran en planta superior del edificio, podran disfrutar de la vista panoramica del mar Limeño.',7,3,3,'2400.00')
--Agregamos 15 registros mas
INSERT INTO Habitacion (nombre,descripcion,idEstado,idTipo,cantidad,precio) VALUES ('406','Estas elegantes habitaciones ase encuentran en planta superior del edificio, podran disfrutar de la vista panoramica del mar Limeño.',1,1,1,'160.00')
INSERT INTO Habitacion (nombre,descripcion,idEstado,idTipo,cantidad,precio) VALUES ('407','Estas elegantes habitaciones ase encuentran en planta superior del edificio, podran disfrutar de la vista panoramica del mar Limeño.',2,2,3,'450.00')
INSERT INTO Habitacion (nombre,descripcion,idEstado,idTipo,cantidad,precio) VALUES ('408','Estas elegantes habitaciones ase encuentran en planta superior del edificio, podran disfrutar de la vista panoramica del mar Limeño.',3,3,4,'800.00')
INSERT INTO Habitacion (nombre,descripcion,idEstado,idTipo,cantidad,precio) VALUES ('409','Estas elegantes habitaciones ase encuentran en planta superior del edificio, podran disfrutar de la vista panoramica del mar Limeño.',4,4,2,'360.00')
INSERT INTO Habitacion (nombre,descripcion,idEstado,idTipo,cantidad,precio) VALUES ('410','Estas elegantes habitaciones ase encuentran en planta superior del edificio, podran disfrutar de la vista panoramica del mar Limeño.',5,1,6,'1800.00')
INSERT INTO Habitacion (nombre,descripcion,idEstado,idTipo,cantidad,precio) VALUES ('411','Estas elegantes habitaciones ase encuentran en planta superior del edificio, podran disfrutar de la vista panoramica del mar Limeño.',6,2,3,'360.00')
INSERT INTO Habitacion (nombre,descripcion,idEstado,idTipo,cantidad,precio) VALUES ('412','Estas elegantes habitaciones ase encuentran en planta superior del edificio, podran disfrutar de la vista panoramica del mar Limeño.',7,3,5,'40000.00')
INSERT INTO Habitacion (nombre,descripcion,idEstado,idTipo,cantidad,precio) VALUES ('413','Estas elegantes habitaciones ase encuentran en planta superior del edificio, podran disfrutar de la vista panoramica del mar Limeño.',1,1,1,'80.00')
INSERT INTO Habitacion (nombre,descripcion,idEstado,idTipo,cantidad,precio) VALUES ('414','Estas elegantes habitaciones ase encuentran en planta superior del edificio, podran disfrutar de la vista panoramica del mar Limeño.',2,2,4,'600.00')
INSERT INTO Habitacion (nombre,descripcion,idEstado,idTipo,cantidad,precio) VALUES ('415','Estas elegantes habitaciones ase encuentran en planta superior del edificio, podran disfrutar de la vista panoramica del mar Limeño.',3,3,2,'400.00')
INSERT INTO Habitacion (nombre,descripcion,idEstado,idTipo,cantidad,precio) VALUES ('416','Estas elegantes habitaciones ase encuentran en planta superior del edificio, podran disfrutar de la vista panoramica del mar Limeño.',4,4,3,'540.00')
INSERT INTO Habitacion (nombre,descripcion,idEstado,idTipo,cantidad,precio) VALUES ('417','Estas elegantes habitaciones ase encuentran en planta superior del edificio, podran disfrutar de la vista panoramica del mar Limeño.',5,1,5,'1500.00')
INSERT INTO Habitacion (nombre,descripcion,idEstado,idTipo,cantidad,precio) VALUES ('418','Estas elegantes habitaciones ase encuentran en planta superior del edificio, podran disfrutar de la vista panoramica del mar Limeño.',6,2,2,'360.00')
INSERT INTO Habitacion (nombre,descripcion,idEstado,idTipo,cantidad,precio) VALUES ('419','Estas elegantes habitaciones ase encuentran en planta superior del edificio, podran disfrutar de la vista panoramica del mar Limeño.',7,3,3,'2400.00')
INSERT INTO Habitacion (nombre,descripcion,idEstado,idTipo,cantidad,precio) VALUES ('420','Estas elegantes habitaciones ase encuentran en planta superior del edificio, podran disfrutar de la vista panoramica del mar Limeño.',1,1,2,'160.00')

SELECT * FROM Habitacion
GO

--TIPO USUARIO 
create table TipoUsuario
(
 idtipoUsuario INT PRIMARY KEY,
 descripcion VARCHAR(20) not null
)
go

--TipoUsuario
INSERT INTO TipoUsuario(idtipoUsuario,descripcion)VALUES(1,'Administrador')
INSERT INTO TipoUsuario(idtipoUsuario,descripcion)VALUES(2,'Cliente')

SELECT * FROM TipoUsuario


--USUARIO
create table Usuario
(
 idUsuario INT NOT NULL IDENTITY(1,1) PRIMARY KEY,
 dni CHAR(8) NOT NULL,
 nombre VARCHAR(40) NOT NULL,
 apellidoPaterno VARCHAR(40) NOT NULL,
 apellidoMaterno VARCHAR(40) NOT NULL,
 correo varchar(40)not null,
 contraseña char(20) not null,
 idtipoUsuario INT default 2 REFERENCES TipoUsuario,
 idHabitacion INT REFERENCES Habitacion
)
go

--Usuario
INSERT INTO Usuario VALUES(75896356,'Veronica','Narvaez','Tapia','vero@outlook.com','vero123',1,1)
INSERT INTO Usuario VALUES(85962536,'Miriam','Salazar','Miranda','miriamSM@gmail.com','miri1234',1,2)
INSERT INTO Usuario VALUES(85962536,'Daniel','Enrique','Manrique','dani@hotmail.com','dani12EM',1,2)
INSERT INTO Usuario VALUES(85962536,'Liz','Casazola','Aguilar','lizca@gmail.com','li*ca*',2,1)
INSERT INTO Usuario VALUES(85962536,'Rodrigo','Narvaez','Miranda','liz@outlook.com','2018*qw',2,1)

SELECT * FROM Usuario
GO
--RESERVA DE HABITACION
CREATE TABLE ReservaHabitacion
(
	idReserva INT NOT NULL IDENTITY(1,1) PRIMARY KEY,
	fechaIngreso DATE NOT NULL,
	fechaSalida DATE NOT NULL,
	idHabitacion INT REFERENCES Habitacion,
	idUsuario int REFERENCES Usuario
)
GO

--ReservaHabitacion
/*INSERT INTO ReservaHabitacion VALUES('12/12/2018','15/12/2018',2,1)
INSERT INTO ReservaHabitacion VALUES('20/10/2018','29/10/2018',2,2)
INSERT INTO ReservaHabitacion VALUES('21/11/2018','30/11/2018',2,2)
INSERT INTO ReservaHabitacion VALUES('10/10/2018','25/10/2018',2,3)
INSERT INTO ReservaHabitacion VALUES('12/01/2019','22/01/2019',2,2)*/

SELECT * FROM ReservaHabitacion
GO

---
USE MASTER
GO

USE Hotel_BD
GO

--Listar Habitaciones
CREATE PROCEDURE SP_ListarHabitaciones
AS
BEGIN
	SELECT H.idHabitacion ID, H.nombre Nombre, EH.nombre Estado, TH.nombre Tipo
	FROM Habitacion H INNER JOIN TipoHabitacion TH
	ON H.idTipo = TH.idTipo INNER JOIN EstadoHabitacion EH
	ON H.idEstado = EH.idEstado
END

EXECUTE SP_ListarHabitaciones
GO 

--Buscar Habitacion por ID
CREATE PROCEDURE SP_BuscarHabitacionByID
@ID INT
AS
BEGIN
	SELECT H.nombre Nombre, H.descripcion, H.nombre Estado, TH.nombre Tipo, H.cantidad, H.precio
	FROM Habitacion H INNER JOIN TipoHabitacion TH
	ON H.idTipo = TH.idTipo INNER JOIN EstadoHabitacion EH
	ON H.idEstado = EH.idEstado
	WHERE H.idHabitacion = @ID
END
GO

EXECUTE SP_BuscarHabitacionByID 1
GO 

--Buscar Habitaciones por precio
CREATE PROCEDURE SP_BuscarHabitacionByPrecio
(
	@Precio1 DECIMAL,
	@precio2 DECIMAL
)
AS
BEGIN
	SELECT H.nombre Nombre,
		   H.descripcion Descripcion,
		   EH.nombre Estado,
		   TH.nombre Tipo,
		   H.cantidad Cantidad,
		   H.precio Precio
	FROM Habitacion H INNER JOIN TipoHabitacion TH
	ON H.idTipo = th.idTipo INNER JOIN EstadoHabitacion EH
	ON H.idEstado = EH.idEstado
	WHERE precio BETWEEN @Precio1 AND @precio2
END
GO

EXECUTE SP_BuscarHabitacionByPrecio 40, 60
GO

--Reserva Habitacion
CREATE PROC SP_ReservaHabitacion
(
@fechaIngreso date,
@fechaSalida date,
@idHabitacion int,
@idUsuario int
)
AS
BEGIN
INSERT INTO ReservaHabitacion(fechaIngreso, fechaSalida, idHabitacion, idUsuario)
VALUES(@fechaIngreso, @fechaSalida, @idHabitacion, @idUsuario)
end
go

EXECUTE SP_ReservaHabitacion '12/12/2018', '12/12/2018', 1, 1
GO

SELECT * FROM ReservaHabitacion
GO

--Agregar Usuario
CREATE PROCEDURE SP_RegistrarUsuario
(
@dni INT,
@nombre VARCHAR(40),
@apellidoPaterno VARCHAR(40),
@apellidoMaterno VARCHAR(40),
@correo VARCHAR(40),
@contraseña VARCHAR(20),
@idTipoUsuario INT,
@idHabitacion INT
)
AS
BEGIN
	INSERT INTO Usuario (dni, nombre, apellidoPaterno, apellidoMaterno, correo, contraseña, idtipoUsuario, idHabitacion) 
	VALUES (@dni, @nombre, @apellidoPaterno, @apellidoMaterno, @correo, @contraseña, @idTipoUsuario, @idHabitacion)
END
GO

EXECUTE SP_RegistrarUsuario 12345678,'Eren','Jaegger','Ackerman','eren@gmail.com','eren123',1,1
GO

SELECT * FROM Usuario
